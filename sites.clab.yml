# Author: Yonz / Net-Innovate Solutions GmbH
# License: The Unlicense
# containerlab LAB file defining a simple wan location, with one sonic switche and three linux clients. 
# The sonic01 nodes needs an additional WAN interface that connects to a WAN Router provided by an ISP
# 
#
name: sites
topology:
  nodes:
# Mother Earth ... Node that represents the core WAN
    earth:
      kind: linux
      image: wbitt/network-multitool:latest
      exec:
        - "ip addr add 192.168.100.100/24 dev eth1"
      ports:
        - 9100:80
# Switches. Sonic 11 Core SW Site 1, Sonic12 Dist. Switch Site 1. Sonic 21 Core Sw. Site 2
    wan1:
      kind: sonic-vs
      image: docker-sonic-vs:latest
    access1:
      kind: sonic-vs
      image: docker-sonic-vs:latest
    wan2:
      kind: sonic-vs
      image: docker-sonic-vs:latest
#
# Linux Clients (11-13 : Site 1; 21: Site 2)            
    linux11:
      kind: linux
      image: wbitt/network-multitool:latest
      exec:
        - "ip addr add 192.168.10.11/24 dev eth1"
      ports:
        - 9111:80
    linux12:
      kind: linux
      image: wbitt/network-multitool:latest
      exec:
        - "ip addr add 192.168.20.12/24 dev eth1"
      ports:
        - 9112:80
    linux13:
      kind: linux
      image: wbitt/network-multitool:latest
      exec:
        - "ip addr add 192.168.20.13/24 dev eth1"
      ports:
        - 9113:80
    linux21:
      kind: linux
      image: wbitt/network-multitool:latest
      exec:
        - "ip addr add 192.168.30.21/24 dev eth1"
      ports:
        - 9121:80        

  links:
    # WAN Link from earrh to eth1 on wan switches (will be replaced in config with a ZeroTrust Tunnel)
    - endpoints: ["earth:eth1", "wan1:eth1"] 
    - endpoints: ["earth:eth2", "wan2:eth1"] 
    #
    # Connection to an access swirch (small network, no distribution SW needed) 
    - endpoints: ["wan1:eth2", "access1:eth1"]
    # Connect the clients
    - endpoints: ["wan1:eth3", "linux11:eth1"]
    - endpoints: ["access1:eth2", "linux12:eth1"]    
    - endpoints: ["access1:eth3", "linux13:eth1"]
    #
    # Second site, one switch and one client.
    - endpoints: ["wan2:eth2", "linux21:eth1"]

      
# Author: Yonz / Net-Innovate Solutions GmbH
# License: The Unlicense
# containerlab LAB file defining a simple wan location, with one sonic switche and three linux clients. 
# The sonic01 nodes needs an additional WAN interface that connects to a WAN Router provided by an ISP
# 
#
name: ralf
topology:
  nodes:
    wan-bridge:
      kind: linux
      image: wbitt/network-multitool:latest
      group: WAN
    wan1:
      kind: sonic-vs
      image: sonic-vs:latest
      group: "Site 1"
      binds:
        - ./frr/wan1/daemons:/etc/frr/daemons
        - ./frr/wan1/frr.conf:/etc/frr/frr.conf
      healthcheck:
        test:
          - CMD-SHELL
          - vtysh -c "show ip route" 2>/dev/null || exit 1
        start-period: 5
        interval: 20
        timeout: 30
        retries: 4

    linux11:
      kind: linux
      image: wbitt/network-multitool:latest
      exec:
        - "ip addr add 192.168.10.11/24 dev eth1"
      ports:
        - 9111:80
      group: "Site 1"
  links:
    - endpoints: ["wan1:Ethernet4", "wan-bridge:eth1"]
    - endpoints: ["wan1:Ethernet8", "linux11:eth1"]